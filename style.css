:root{
  /* Typography scale (keep app-wide balance consistent) */
  --fs-base: 1rem;
  --fs-lg: 1.05rem;
  --fs-xl: 1.15rem;
  --fs-xxl: 1.5rem;
  --fs-sm: 0.92rem;
  --fs-xs: 0.82rem;
  --fs-xxs: 0.75rem;
  --fs-micro: 0.55rem;

  /* Line-height scale */
  --lh-body: 1.55;
  --lh-ui: 1.25;
  --lh-tight: 1.10;

  --padX:12px;
  --padCard:16px;
  --gap:10px;
  --controlH:52px;
  --controlR:16px;
  --controlPX:16px;
  --controlPY:14px;
  --controlFS: var(--fs-lg);
  --bg:#111; --card:#1f1f1f; --border:#333;
  --accent:#00c896; --accentSoft:rgba(0,200,150,.12);
  --text:#f5f5f5; --sub:#bbb; --danger:#ff4f4f;
  --r:16px;
}
*{box-sizing:border-box}
html{-webkit-text-size-adjust:100%;text-size-adjust:100%}
html,body{margin:0;padding:0;background:radial-gradient(circle at top,#252525,#050505);color:var(--text);
  font-family:system-ui,-apple-system,"Segoe UI",sans-serif;font-size:22px;line-height:var(--lh-body)}
body{min-height:100vh;display:flex;flex-direction:column}
.app-header{padding:16px var(--padX) 8px;text-align:center;max-width:760px;width:100%;margin:0 auto;box-sizing:border-box}
.app-header h1{margin:0;font-size:2.0rem;letter-spacing:.04em}
.app-subtitle{margin:6px 0 0;font-size:var(--fs-base);color:var(--sub)}
.tab-bar{display:flex;flex-direction:column;gap:var(--gap);position:static;
  max-width:760px;width:100%;margin:0 auto;box-sizing:border-box;
  padding:10px var(--padX) 0;background:transparent}

.tab-button{width:100%;display:flex;align-items:center;justify-content:center;text-align:center;padding:var(--controlPY) var(--controlPX);font-size:var(--controlFS);line-height:var(--lh-ui);box-sizing:border-box;border-radius:var(--controlR);border:1px solid var(--border);background:rgba(0,0,0,.4);color:var(--sub);cursor:pointer;min-height:var(--controlH)}
.tab-button.active{background:var(--accentSoft);border-color:var(--accent);color:var(--accent);font-weight:600}
.main{flex:1;padding:8px var(--padX) 16px;max-width:760px;width:100%;margin:0 auto}
.section{display:none}
.section.active{display:block}
.section h2{margin:8px 0 4px;font-size:var(--fs-xl)}
.card{background:var(--card);border-radius:var(--r);border:1px solid var(--border);padding:var(--padCard);
  box-shadow:0 12px 30px rgba(0,0,0,.25);margin-bottom:var(--gap);font-size:var(--fs-base);color:var(--sub);margin-top:8px;margin-bottom:4px}


#fortuneControlsCard{margin-bottom:calc(var(--gap) * 1.8)}
#connSettingsCard{margin-bottom:calc(var(--gap) * 1.6)}
.field-row{display:flex;gap:var(--gap);align-items:center}
.field-row>*{min-width:0}

.action-row{flex-wrap:wrap}
.action-row #translateBtn{flex:2 1 180px}
.action-row #randomBtn{flex:1 1 120px}
.action-row #clearBtn{flex:1 1 120px}
.action-row #translateState{flex:0 0 auto}
@media (max-width: 430px){
  html{font-size:22px}

  .action-row #translateBtn{flex:1 1 100%}
  .action-row #randomBtn,.action-row #clearBtn,.action-row #translateState{flex:1 1 120px}
}

.two-col{display:grid;grid-template-columns:1fr 1fr;gap:var(--gap)}
@media (max-width:640px){.two-col{grid-template-columns:1fr}}

/* iPhone/Safari: date input indicator can cause a broken right-side block.
   On small screens we hide the native indicator to keep the control visually consistent. */
@media (max-width:640px){
  input[type="date"]{
    -webkit-appearance:none;
    appearance:none;
    background-image:none;
  }
  input[type="date"]::-webkit-calendar-picker-indicator{
    opacity:0;
    display:none;
  }
  input[type="date"]::-webkit-clear-button,
  input[type="date"]::-webkit-inner-spin-button{
    display:none;
  }
  input[type="date"]::-webkit-datetime-edit{
    text-align:center;
  }
}


input[type="text"],input[type="date"],textarea,select{
  width:100%;padding:14px 18px;border-radius:16px;border:1px solid var(--border);
  background:#151515;color:var(--text);font-size:var(--fs-lg);min-height:52px;line-height:var(--lh-ui)
}
textarea{resize:vertical;line-height:var(--lh-body)}
.select{appearance:auto}
.select.small{padding:12px var(--controlPX);font-size:var(--controlFS);border-radius:var(--controlR);min-height:var(--controlH)}

select:disabled{opacity:0.75;cursor:not-allowed}
.primary-btn,.secondary-btn,.ghost-btn{
  border-radius:var(--controlR);border:1px solid transparent;padding:var(--controlPY) var(--controlPX);font-size:var(--controlFS);cursor:pointer;white-space:nowrap;min-height:var(--controlH)
}

.primary-btn{background:var(--accent);color:#000;font-weight:700}
.secondary-btn{background:transparent;border-color:var(--accent);color:var(--accent)}
.ghost-btn{background:transparent;border-color:var(--border);color:var(--sub)}
.ghost-btn.small{padding:10px 14px;font-size:var(--fs-sm);min-height:44px}
.full-width{width:100%;margin-top:12px}
.note{margin:8px 0 0;color:var(--sub);font-size:var(--fs-xs);line-height:1.4}
.pill{
  padding:10px 14px;border-radius:14px;border:1px solid var(--border);
  background:#141414;color:var(--sub);font-size:var(--fs-sm);min-width:88px;text-align:center;white-space:nowrap}
.msg{margin-top:10px;font-size:var(--fs-sm)}
.msg.ok{color:var(--accent)}
.msg.err{color:var(--danger)}
.summary{cursor:pointer;color:var(--accent);font-weight:700;list-style:none;display:flex;align-items:center;gap:8px;flex-wrap:wrap}
details.card[open] > summary.summary{margin-bottom:var(--gap)}
details summary{user-select:none}
details summary::-webkit-details-marker{display:none}

.word-list{max-height:60vh;overflow-y:auto;padding-right:4px;margin-top:8px}
.word-item{border-radius:12px;border:1px solid var(--border);padding:8px 10px;margin-bottom:8px;background:#151515}
.word-top{display:flex;justify-content:space-between;align-items:center;gap:8px}
.word-main{font-weight:700;font-size:var(--fs-xl)}
.word-meaning{margin-top:6px;font-size:var(--fs-lg)}
.word-meta{margin-top:6px;font-size:var(--fs-sm);color:var(--sub)}
.word-actions{margin-top:6px;display:flex;gap:6px;align-items:center;flex-wrap:wrap}
.delete-btn{border-radius:999px;border:1px solid var(--danger);background:transparent;color:var(--danger);
  font-size:var(--fs-base);padding:4px 10px;cursor:pointer}
.tts-btn{border-radius:999px;border:1px solid var(--border);padding:6px 10px;font-size:var(--fs-xs);background:#111;color:var(--sub);cursor:pointer}

.quiz-term{display:inline-block}
.quiz-tts{margin-left:8px;padding:4px 10px;vertical-align:middle;}

.list-header{display:flex;justify-content:space-between;align-items:center;font-size:var(--fs-xs);margin-bottom:6px}
.list-controls{display:flex;gap:6px;align-items:center}

.list-counts{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  align-items:center;
  margin-top:8px;
  font-size:var(--fs-xs);
  color:var(--muted);
}
.count-pill{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,0.10);
  background:rgba(255,255,255,0.04);
  white-space:nowrap;
}
.count-pill b{color:var(--fg);font-weight:800}


.quiz-area{margin-top:12px;padding:10px;border-radius:12px;background:#151515;border:1px dashed var(--border);min-height:120px}

/* --- Fortune --- */
.fortune-results{display:flex;flex-direction:column;gap:12px}
.fortune-item{border:1px solid rgba(255,255,255,0.12);border-radius:14px;padding:16px;background:#101010}
.fortune-head{display:flex;align-items:flex-start;justify-content:space-between;gap:var(--gap)}
.fortune-title{font-weight:800;font-size:var(--fs-xxl);line-height:var(--lh-tight);align-items:center;gap:8px;flex-wrap:wrap}
.fortune-pill{font-size:var(--fs-micro);padding:4px 8px;border-radius:999px;background:rgba(0,200,150,0.16);border:1px solid rgba(0,200,150,0.32)}
.fortune-score{font-size:var(--fs-micro);opacity:0.85}

.fortune-meta{display:flex;flex-direction:column;align-items:flex-end;gap:8px;min-width:140px}
.fortune-bar{width:180px;max-width:46vw;height:10px;border-radius:999px;background:rgba(0,200,150,0.12);border:1px solid rgba(0,200,150,0.22);overflow:hidden}
.fortune-bar-fill{height:100%;width:0%;border-radius:999px;background:rgba(0,200,150,0.62);transition:width 260ms ease}
@media (max-width:430px){
  .fortune-meta{min-width:120px}
  .fortune-bar{width:150px}
}

.fortune-text{margin-top:10px;line-height:1.65;font-size:var(--fs-xl)}
.fortune-text .w{display:inline-block;padding:1px 2px;border-radius:6px;cursor:pointer}
.fortune-text .w:hover{background:rgba(255,255,255,0.08)}
.fortune-actions{display:flex;gap:var(--gap);flex-wrap:wrap;margin-top:10px}
.fortune-actions button{padding:10px 14px;border-radius:var(--controlR);min-height:44px;font-size:var(--fs-sm)}
.fortune-jp{margin-top:8px;opacity:0.92;line-height:var(--lh-body);font-size:var(--fs-xl)}
.quiz-q{font-size:var(--fs-lg);font-weight:700;margin:0 0 10px}
.quiz-choices{display:grid;grid-template-columns:1fr 1fr;gap:8px}
@media (max-width:520px){.quiz-choices{grid-template-columns:1fr}}
.choice-btn{
  border-radius:var(--controlR);border-radius:16px;border:2px solid var(--border);background:#111;color:var(--text);
  padding:16px 52px 16px 16px;text-align:left;cursor:pointer;font-size:var(--fs-lg);min-height:56px;position:relative
}

/* 日→英クイズ: 選択肢（英単語）の下に日本語訳を表示 */
.choice-main{font-weight:700;line-height:var(--lh-ui);font-size:var(--fs-sm);color:var(--sub);line-height:1.25}
.choice-sub:empty{display:none}
.choice-btn.correct{border-color:var(--accent);background:rgba(0,200,150,.12)}
.choice-btn.wrong{border-color:var(--danger);background:rgba(255,79,79,.10)}
.quiz-foot{margin-top:10px;display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.quiz-mini{font-size:var(--fs-xs);color:var(--sub)}

.small-btn{
  border-radius:999px;border:1px solid var(--border);background:transparent;color:var(--sub);
  padding:6px 10px;font-size:var(--fs-xs);cursor:pointer
}
.small-btn.accent{border-color:var(--accent);color:var(--accent)}
.small-btn.danger{border-color:var(--danger);color:var(--danger)}
.app-footer{padding:6px 12px 10px;display:flex;align-items:center;gap:8px;font-size:var(--fs-xxs);color:var(--sub);
  border-top:1px solid #141414;background:#050505}
.footer-text{flex:1}
@media (max-width:400px){html,body{font-size:22px}}

/* Synonyms line */
.word-synonyms{
  margin-top:6px;
  font-size:var(--fs-sm);
  color: var(--sub);
}

/* inline row for input + button */
.row{
  display:flex;
  gap:var(--gap);
  align-items:stretch;
}
.row > input[type="text"]{flex:1}

.conn-status{font-size:0.9rem;color: var(--sub);margin-left:0;;}

.edit-banner{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:12px 14px;border:1px solid var(--border);background:#0f1412;border-radius:16px;margin:10px 0 12px;}
.edit-title{font-weight:800;font-size:var(--fs-lg);color:var(--text)}
.edit-sub{flex:1;color:var(--sub);font-size:var(--fs-sm);line-height:1.2}


/* Quiz result feedback */
.quiz-result{margin-top:10px;font-size:var(--fs-xl);font-weight:800;display:flex;align-items:center;gap:10px;}
.quiz-result .mark{font-size:var(--fs-h1);line-height:var(--lh-ui);}
.quiz-result.correct{color:var(--accent);}
.quiz-result.wrong{color:var(--danger);}

.quiz-reveal{margin-top:6px;margin-bottom:6px;}
.quiz-reveal-word{font-size:var(--fs-lg);font-weight:800;letter-spacing:0.01em;}
.quiz-reveal-meaning{margin-top:4px;font-size:var(--fs-sm);opacity:0.9;}
.quiz-next-wrap{margin-top:10px;}
.quiz-next-btn{height:46px;}

.choice-btn.correct::after{content:"○";position:absolute;right:16px;top:50%;transform:translateY(-50%);font-size:var(--fs-xxl);font-weight:900;color:var(--accent)}
.choice-btn.wrong::after{content:"✕";position:absolute;right:16px;top:50%;transform:translateY(-50%);font-size:var(--fs-xxl);font-weight:900;color:var(--danger)}


/* Fortune (embedded horoscope) */
.fortune-wrap {
  width: 100%;
  height: calc(100vh - 260px);
  overflow: hidden;
  border-radius: 14px;
}

#fortuneFrame {
  width: 100%;
  height: 100%;
  border: 0;
  background: transparent;
}


/* iOS safe-area & viewport stability (for iPhone 16 / iOS Safari & PWA) */
@supports (padding: env(safe-area-inset-top)) {
  body{
    padding-top: env(safe-area-inset-top);
    padding-right: env(safe-area-inset-right);
    padding-bottom: env(safe-area-inset-bottom);
    padding-left: env(safe-area-inset-left);
  }
}

html, body{
  width: 100%;
  overflow-x: hidden;
}

/* Prefer dynamic viewport units when available (fixes iOS 100vh issues) */
@supports (height: 100dvh) {
  body{ min-height: 100dvh; }
  .fortune-wrap{ height: calc(100dvh - 260px); }
}
